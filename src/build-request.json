{
  "kind": "build_request",
  "title": "Fix mining start flow so sessions can start after configuration is saved",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-15",
      "text": "Fix the mining start preconditions and default state behavior so a user who has saved a mining configuration can start mining even when no MiningState record exists yet. Specifically: ensure the backend returns a sensible default MiningState when a MiningConfig exists but MiningState is missing, and ensure startMining transitions the state to Active without requiring an existing MiningState.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "But mining process is not starting bro"
        ]
      },
      "acceptanceCriteria": [
        "If a caller has a saved MiningConfig but has never started mining, getMiningState returns a non-null MiningState with isActive=false, lastStartTimestamp=null, and cumulative counters initialized (not trapping and not returning null).",
        "Calling startMining after saving MiningConfig results in getMiningState returning isActive=true and lastStartTimestamp set.",
        "If startMining is called while already active, the backend responds predictably (either no-op with no state corruption, or traps with a clear English message).",
        "Cumulative runtime/earnings are not unintentionally reset on subsequent start/stop cycles (starting a new session should preserve cumulative totals and only update session timestamps)."
      ]
    },
    {
      "id": "REQ-16",
      "text": "Update the dashboard start/stop UX so the Start Mining button is available whenever a mining configuration exists, even if miningState is currently null/empty. Do not block the dashboard behind \"Configuration Required\" based solely on miningState.config; instead, use the saved mining configuration (miningConfig) to determine whether configuration is complete, and allow starting mining from the dashboard.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "But mining process is not starting bro"
        ]
      },
      "acceptanceCriteria": [
        "After saving settings in the Mining Settings page, returning to the dashboard shows start/stop controls (not only a configuration-required card).",
        "If no mining configuration exists, the dashboard shows an English message indicating configuration is required and provides a clear path to the Settings section (e.g., a button that navigates to Settings).",
        "Clicking Start Mining changes the status indicator to Active within one refresh cycle (via react-query invalidation/refetch).",
        "If startMining fails (e.g., authorization/config missing), the UI shows an English toast error that is actionable (not silent), and the button leaves the system in a consistent state (no stuck loading)."
      ]
    },
    {
      "id": "REQ-17",
      "text": "Ensure the recent activity/events list reflects mining start/stop actions immediately after the user clicks Start Mining/Stop Mining, including when mining is started for the first time after configuration. Any backend trap/permission issues should be visible to the user through English error messages.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "But mining process is not starting bro"
        ]
      },
      "acceptanceCriteria": [
        "After Start Mining succeeds, the events query shows a new \"Started\" event without requiring a full page refresh.",
        "After Stop Mining succeeds, the events query shows a new \"Stopped\" event with session-duration details (if available) without requiring a full page refresh.",
        "If the backend rejects the action (e.g., missing config, unauthorized), the frontend displays the backend-provided English error message (or a clear English fallback) and does not show a misleading success toast."
      ]
    }
  ],
  "constraints": [
    "All user-facing text must be in English.",
    "Backend must remain a single Motoko actor in backend/main.mo (no additional backend services).",
    "Do not modify files under frontend/src/components/ui or other frontend immutable paths listed in SYSTEM_CONTEXT; compose them instead."
  ],
  "nonGoals": [
    "Do not add real Bitcoin mining or external network integrations.",
    "Do not add new authentication providers beyond Internet Identity.",
    "Do not redesign unrelated pages (settings/payouts) beyond what is necessary to make mining start work correctly."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}